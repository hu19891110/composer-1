<html>
  <head>
    <title>Composer</title>
    <style type="text/css">
      body {
        font-family:verdana;
      }
      
      li, ul{
        list-style:none;
        margin:0px;
        padding:0px;
        cursor: pointer;
      }
      
      .composer .toolbar ul.in, .composer .toolbar ul.out {
        display:none;
      }
      
      ul.ports li a {
        border:1px solid #000;
        height:10px;
        width:10px;
        float:left;
        background:white;
        margin-right:5px;
      }
      
      ul.ports.in li a:hover {
        border:1px solid #888;
        border-top: none;
      }
      
      ul.ports.out li a:hover {
        border:1px solid #888;
        border-bottom:1px solid black;
      }

      ul.ports.in li a {
        border-top:none;
      }
      
      ul.ports.out li a {
        background:black;
      }
      
      .composer {
        border:1px solid #AAA;
      }
      
      .composer .canvas {
        background:#DEDEDE;
        width:80%;
        height:400px;
        border-right:1px solid #BBB;
      }
      
      .node {
        position:absolute;
        padding: 0px 5px;
        background:white;
        border:1px solid #000;
        
      }      
            
      .dragging {
        position:absolute;
        padding:.5em;
        border:1px solid #000;
        position:absolute;
        background:#25F;
      }
    
    </style>    
    <script type="text/javascript" src="lib/composer.js"></script>    
    <script type="text/javascript">
      jQuery(function() {
        jQuery(".composer .toolbar li").drag(function(ev){ // drag start
          return jQuery(this).clone().appendTo( document.body )
                .hide().addClass("dragging").show(200);
        }, function(ev){ // dragging
          jQuery( ev.dragProxy ).css({
            left: ev.offsetX, 
            top: ev.offsetY
          });
        }, function(ev) { // dragend
          if (ev.dropTarget && 
              jQuery(ev.dragProxy).parent().is(".canvas") )
          {
            jQuery(ev.dragProxy).removeClass("dragging").addClass("node");
          } else {
            jQuery(ev.dragProxy).remove();
          }
        });

        jQuery(".composer .canvas").drop(function(ev) { // drop start
            if (jQuery(ev.dragProxy).hasClass("node")) {
              return false;
            }
            jQuery(this).css({"background-color" : "#EEEEEE"});
          },
          function(ev){ // drop
            
            jQuery( ev.dragProxy ).css({
              left: ev.offsetX, 
              top: ev.offsetY
            });
          
            jQuery(this).append(ev.dragProxy).show();
            
            // allow this item to be dragged again
            jQuery(ev.dragProxy).drag(function() { 
              return jQuery(this);
            },
            function(ev) {
              jQuery(this).css({
                left: ev.offsetX, 
                top: ev.offsetY
              });
            });
            
            // setup pipe dragging on the outbound ports (for now)
            jQuery(ev.dragProxy).find(".out li a").drag(function() { 
              return jQuery(this).clone().addClass("dragging");
            },
            function(ev) {
              jQuery(ev.dragProxy).css({
                left: ev.offsetX, 
                top: ev.offsetY
              });
            },
            function(ev) {
              jQuery(ev.dragProxy).remove();
            });
          }
          ,function(ev){ // drop end
            jQuery( this ).removeClass("active");
            jQuery(this).css({"background-color" : ""});
        });
      });
    </script>
    
  </head>
  <body>
    <h1>Composer</h1>
    <p>
      Visual Control / Data Flow editor
    </p>
    
    <h2>License</h2>
    <p>
      MIT, see <a href="LICENSE.txt">LICENSE.txt</a>
    </p>
    
    <h2>Demo</h2>
    <div class="composer">
      <div class="toolbar">
        <ul>
          <li>
            window.prompt
            <ul class="ports out">
              <li><a name="Value"></a></li>
            </ul>
          </li>
          <li>
            <ul class="ports in">
              <li><a name="Message"></a></li>
            </ul>          
            window.alert
          </li>
        </ul>
      </div>
      <div class="canvas"></div>
      <div class="staging"></div>
    </div>
  </body>
</html>
